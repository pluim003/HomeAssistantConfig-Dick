# sensors.yaml
# v2022.01.07
#
# History:
#
# v2022.01.02 - Initial version
# v2022.01.03 - Moved sensitive data to secrets.yaml
# v2022.01.07 - Added sensors to nicely format the total export/import of
#               electricity and gas
#

  - platform: command_line                                                                                          
    name: rpi4_cpu_temperatuur                                                                                      
    command: "cat /sys/class/thermal/thermal_zone0/temp"                                                            
    # If errors occur, make sure configuration file is encoded as UTF-8                                              

    unit_of_measurement: "°C"                                                                                   
    value_template: "{{ value | multiply(0.001) | round(1) }}"                                                       
  - platform: template                                                                                               
    sensors:                                                                                                         
      zonsopkomst:                                                                                                   
        friendly_name: 'Zonsopkomst'                                                                                 
        value_template: >                                                                                            
          {{ as_timestamp(states.sun.sun.attributes.next_rising) | timestamp_custom(' %H:%M') | replace(" 0", "") }} 
        icon_template: mdi:weather-sunset-up                                                                         
      zonsondergang:                                                                                                 
        friendly_name: 'Zonsondergang'                                                                               
        value_template: >                                                                                            
          {{ as_timestamp(states.sun.sun.attributes.next_setting) | timestamp_custom(' %H:%M') | replace(" 0", "") }}
        icon_template: mdi:weather-sunset-down                                                                       
  - platform: systemmonitor                                                                                          
    resources:                                                                                                       
      - type: disk_use_percent                                                                                       
        arg: /config                                                                                                 
      - type: memory_free                                                                                            
                                                                                                                     
  - platform: afvalwijzer
    provider: mijnafvalwijzer
    postal_code: !secret adres_postcode
    street_number: !secret adres_huisnummer
    suffix: !secret adres_toevoeging
    include_date_today: false
    default_label: Geen
    id: ''
    exclude_list: ' ' 

  - platform: template
    sensors:
      status_dick:
        value_template: '{{ states.input_select.status_dick_dropdown.state }}'
        friendly_name: 'Dick'
      status_inge:
        value_template: '{{ states.input_select.status_inge_dropdown.state }}'
        friendly_name: 'Inge'
      status_michel:
        value_template: '{{ states.input_select.status_michel_dropdown.state }}'
        friendly_name: 'Michel'
      status_emilie:
        value_template: '{{ states.input_select.status_emilie_dropdown.state }}'
        friendly_name: 'Emilie'

  - platform: template
    sensors:
       p1_meter_totale_stroom_export_t1:
         friendly_name: 'Totale export stroom dal'
         unit_of_measurement : "kWh"
         value_template: "{{ states('sensor.p1_meter_total_power_export_t1') | round(1, default=0) }} "
       p1_meter_totale_stroom_export_t2:
         friendly_name: 'Totale export stroom piek'
         unit_of_measurement : "kWh"
         value_template: "{{ states('sensor.p1_meter_total_power_export_t2') | round(1, default=0) }} "
       p1_meter_totale_stroom_import_t1:
         friendly_name: 'Totale import stroom dal'
         unit_of_measurement : "kWh"
         value_template: "{{ states('sensor.p1_meter_total_power_import_t1') | round(1, default=0) }} "
       p1_meter_totale_stroom_import_t2:
         friendly_name: 'Totale export stroom dal'
         unit_of_measurement : "kWh"
         value_template: "{{ states('sensor.p1_meter_total_power_import_t2') | round(1, default=0) }} "
       p1_meter_totale_gas_verbruik:
         friendly_name: 'Totale verbruik gas'
         unit_of_measurement : "m³"
         value_template: "{{ states('sensor.p1_meter_total_gas') | round(1, default=0) }} "


