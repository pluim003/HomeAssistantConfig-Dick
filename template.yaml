# template.yaml
# v2022.01.11
#
# History:
#
# v2022.01.07 - Initial empty version
# v2022.01.08 - Added template-sensors from sensor.yaml
# v2022.01.11 - Added 2 sensors to keep track of total imported and 
#               total exported electricity
#

# sensors to layout the energy ussage a bit nicer

  - sensor:
      - name: "Totale stroom export dal"
        unit_of_measurement : "kWh"
        state: "{{ states('sensor.p1_meter_total_power_export_t1') | round(1, default=0) }} "
        icon: mdi:flash
  - sensor:
      - name: 'Totale stroom export piek'
        unit_of_measurement : "kWh"
        state: "{{ states('sensor.p1_meter_total_power_export_t2') | round(1, default=0) }} "
        icon: mdi:flash
  - sensor:
      - name: 'Totale stroom import dal'
        unit_of_measurement : "kWh"
        state: "{{ states('sensor.p1_meter_total_power_import_t1') | round(1, default=0) }} "
        icon: mdi:flash
  - sensor:
      - name: 'Totale stroom import piek'
        unit_of_measurement : "kWh"
        state: "{{ states('sensor.p1_meter_total_power_import_t2') | round(1, default=0) }} "
        icon: mdi:flash
  - sensor:
      - name: 'Totale gas verbruik'
        unit_of_measurement : "mÂ³"
        state: "{{ states('sensor.p1_meter_total_gas') | round(1, default=0) }} "
        icon: mdi:gas-cylinder
  - sensor:
      - name: 'Totale stroom import'
        unit_of_measurement : "kWh"
        state: "{{ (states('sensor.p1_meter_total_power_import_t1') |round(1, default=0)  + states('sensor.p1_meter_total_power_import_t2') | round(1, default=0)) | round(1, default=0) }} "
        icon: mdi:flash
  - sensor:
      - name: 'Totale stroom export'
        unit_of_measurement : "kWh"
        state: "{{ (states('sensor.p1_meter_total_power_export_t1') |round(1, default=0)  + states('sensor.p1_meter_total_power_export_t2') | round(1, default=0)) | round(1, default=0) }} "
        icon: mdi:flash
  - sensor: 
      - name: 'Totale stroom verbruik'
        unit_of_measurement : "kWh"
        state: "{{ (states('sensor.p1_meter_total_power_import_t1') |round(1, default=0)  + states('sensor.p1_meter_total_power_import_t2') | round(1, default=0) -                      states('sensor.p1_meter_total_power_export_t1') |round(1, default=9)  - states('sensor.p1_meter_total_power_export_t2') | round(1, default=0)) | round(1, default=0)  }} "
        icon: mdi:flash

# sensors for sunrise and sunset

  - sensor:
      - name: 'Zonsopkomst'
        state: >
          {{ as_timestamp(states.sun.sun.attributes.next_rising) | timestamp_custom(' %H:%M') | replace(" 0", "") }}
        icon: mdi:weather-sunset-up
  - sensor:
        name: 'Zonsondergang'
        state: >
          {{ as_timestamp(states.sun.sun.attributes.next_setting) | timestamp_custom(' %H:%M') | replace(" 0", "") }}
        icon: mdi:weather-sunset-down

